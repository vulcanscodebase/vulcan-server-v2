
    // âœ… License validation - Check if pod has enough available licenses
    // Super admins bypass this check
    if (licenses && licenses > 0 && !requester.isSuperAdmin) {
      const podTotal = pod.totalLicenses || 0;
      const podAssigned = pod.assignedLicenses || 0;
      const podAvailable = Math.max(0, podTotal - podAssigned);
      
      const previousUserLicenses = user?.licenses || 0;
      const licensesToAssign = isNewUser ? licenses : Math.max(0, licenses - previousUserLicenses);
      
      if (licensesToAssign > podAvailable) {
        res.status(400).json({
          message: `Insufficient licenses in pod. Available: ${podAvailable}, Requested: ${licensesToAssign}.`,
          pod: {
            name: pod.name,
            totalLicenses: podTotal,
            assignedLicenses: podAssigned,
            availableLicenses: podAvailable,
          },
        });
        return;
      }
    }

